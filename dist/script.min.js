document.addEventListener("DOMContentLoaded",()=>{const e=()=>window.innerWidth<1024,t=(e,t)=>{let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}},s=document.querySelector(".burger-menu"),i=document.getElementById("main-nav"),n=document.querySelectorAll(".main-nav a"),a=document.getElementById("current-year"),l=["images/sites-exemples/am2.0-exemple-site3-mbperformance.webp","images/sites-exemples/am2.0-exemple-site4-mbperformance.webp","images/sites-exemples/am2.0-exemple-site2-shodokan.webp","images/sites-exemples/am2.0-exemple-site1-shodokan.webp"];a&&(a.textContent=(new Date).getFullYear());const r=()=>{const s=document.getElementById("case-studies-slider");if(!s)return;const i=document.getElementById("case-studies-controls-wrapper"),n=document.getElementById("case-studies-prev"),a=document.getElementById("case-studies-next"),l=Array.from(s.querySelectorAll(".case-study-card"));if(!i||l.length<2||!n||!a)return void(i&&i.classList.add("hidden"));if(e())return i&&i.classList.add("hidden"),s.classList.remove("lg:flex","lg:flex-nowrap","lg:overflow-x-scroll","lg:scrollbar-hide"),s.classList.add("grid","gap-8"),void l.forEach(e=>{e.classList.add("is-active"),e.classList.remove("is-inactive")});s.classList.add("lg:flex","lg:flex-nowrap","lg:overflow-x-scroll","lg:scrollbar-hide"),s.classList.remove("grid","gap-8"),i&&i.classList.remove("hidden");const r=l.length;let o=0;const c=e=>{l.forEach((t,s)=>{const i=s===e;t.classList.toggle("is-active",i),t.classList.toggle("is-inactive",!i)}),n.disabled=0===e,a.disabled=e===r-1},d=e=>{if(e<0||e>=r)return;const t=l[e],i=t.offsetLeft,n=t.offsetWidth,a=i-s.clientWidth/2+n/2;s.scroll({left:a,behavior:"smooth"}),o=e,c(o)},u=e=>{d(o+e)};let m;n.addEventListener("click",()=>u(-1)),a.addEventListener("click",()=>u(1));m=setInterval(()=>{const e=l[0];if(e&&s.offsetWidth>0){const t=e.offsetLeft,i=e.offsetWidth,n=t-s.clientWidth/2+i/2;s.scroll({left:n,behavior:"auto"}),o=0,c(o),m&&clearInterval(m)}},100),window.addEventListener("resize",t(()=>{e()||d(o),c(o)},300))},o=()=>{const s=document.getElementById("articles-slider");if(!s)return;const i=Array.from(s.querySelectorAll(".article-card")),n=[document.getElementById("articles-prev-mobile"),document.getElementById("articles-prev-desktop")].filter(e=>e),a=[document.getElementById("articles-next-mobile"),document.getElementById("articles-next-desktop")].filter(e=>e);if(0===i.length||0===n.length&&0===a.length)return;i.forEach((e,t)=>{e.setAttribute("data-card-index",t)});let l=s.scrollLeft;const r=()=>{if(0===s.offsetWidth)return;let e=-1;const t=window.innerWidth/2;i.forEach((s,n)=>{const a=s.getBoundingClientRect(),l=a.left+a.width/2,r=Math.abs(l-t);r<150?(s.classList.add("article-active"),s.classList.remove("article-inactive"),(-1===e||r<Math.abs(i[e].getBoundingClientRect().left+i[e].offsetWidth/2-t))&&(e=n)):(s.classList.add("article-inactive"),s.classList.remove("article-active"))});let l=!0,r=!0;-1!==e?(l=0===e,r=e===i.length-1):(l=s.scrollLeft<=10,r=s.scrollLeft>=s.scrollWidth-s.clientWidth-10),n.forEach(e=>e.disabled=l),a.forEach(e=>e.disabled=r)},o=t=>{e()&&"function"==typeof window.toggleArticleCardCollapse&&window.toggleArticleCardCollapse();const n=s.querySelector(".article-active");let a=-1;if(n){a=parseInt(n.getAttribute("data-card-index"))+t}else{const e=s.offsetWidth/2;let n=-1,l=1/0;if(i.forEach((t,i)=>{t.getBoundingClientRect();const a=t.offsetLeft+t.offsetWidth/2-s.scrollLeft,r=Math.abs(a-e);r<l&&(l=r,n=i)}),-1===n)return;a=n+t}if(a>=0&&a<i.length){const e=i[a],t=e.offsetLeft,n=e.offsetWidth,l=t-s.clientWidth/2+n/2;s.scroll({left:l,behavior:"smooth"})}};n.forEach(e=>e.addEventListener("click",()=>o(-1))),a.forEach(e=>e.addEventListener("click",()=>o(1)));let c=setInterval(()=>{const e=i[1];if(e&&s.offsetWidth>0){const t=e.offsetLeft,i=e.offsetWidth,n=t-s.clientWidth/2+i/2;s.scroll({left:n,behavior:"auto"}),r(),c&&clearInterval(c)}},100);const d=()=>{const t=Math.abs(s.scrollLeft-l);e()&&t>50&&"function"==typeof window.toggleArticleCardCollapse&&window.toggleArticleCardCollapse(),l=s.scrollLeft,r()};s.debouncedUpdate&&s.removeEventListener("scroll",s.debouncedUpdate),s.debouncedUpdate=t(r,100),s.addEventListener("scroll",s.debouncedUpdate),s.debouncedScrollEnd&&s.removeEventListener("scroll",s.debouncedScrollEnd),s.debouncedScrollEnd=t(d,300),s.addEventListener("scroll",s.debouncedScrollEnd),r()};let c;const d=(t,s)=>{const i=document.querySelectorAll("[data-expandable-card]");if(!e()&&void 0===s)return;const n=t.getAttribute("data-initial-height")||"20vh",a="true"===t.getAttribute("data-expanded"),l=void 0!==s?s:!a,r=t.querySelector("[data-card-wrapper]"),o=t.querySelector("[data-toggle-btn]"),c=o?o.firstChild:null,u=t.closest("section");if(l!==a)if(l){if(i.forEach(e=>{e!==t&&"true"===e.getAttribute("data-expanded")&&e.closest("section")===u&&d(e,!1)}),e()){r.style.maxHeight="150vh";const s=r.scrollHeight;t.style.setProperty("--content-height",`${s}px`),r.style.maxHeight=n,requestAnimationFrame(()=>{t.setAttribute("data-expanded","true"),o&&o.setAttribute("aria-expanded","true"),t.classList.add("is-expanded"),setTimeout(()=>(t=>{if(!e())return;const s=t.getBoundingClientRect(),i=s.top+window.scrollY,n=window.innerHeight/2-s.height/2;window.scrollTo({top:i-n,behavior:"smooth"})})(t),50)})}else t.setAttribute("data-expanded","true"),r.style.maxHeight="initial";c&&(c.nodeValue="Masquer les détails ")}else e()?(r.style.maxHeight=n,t.classList.remove("is-expanded"),setTimeout(()=>{t.setAttribute("data-expanded","false"),o&&o.setAttribute("aria-expanded","false"),r.style.maxHeight=null},700)):t.setAttribute("data-expanded","false"),c&&(c.nodeValue="Voir les détails")},u=()=>{const s=document.querySelectorAll("[data-expandable-card]");if(!s.length)return;c=d,s.forEach(t=>{const s=t.querySelector("[data-toggle-btn]"),i=s?s.firstChild:null,n="true"===t.getAttribute("data-expanded");i&&(i.nodeValue=n?"Masquer les détails ":"Voir les détails"),s&&s.addEventListener("click",e=>{e.preventDefault(),d(t)}),e()&&d(t,!1)});window.addEventListener("resize",t(()=>{s.forEach(t=>{if(!e()){t.setAttribute("data-expanded","false"),t.querySelector("[data-card-wrapper]").style.maxHeight=null;const e=t.querySelector("[data-toggle-btn]");e&&(e.firstChild.nodeValue="Voir les détails")}})},300))};window.toggleArticleCardCollapse=()=>{if(!e()||!c)return;const t=document.getElementById("articles");if(!t)return;const s=t.querySelector('[data-expanded="true"]');s&&(c(s,!1),console.log("Carte expansible d'article fermée."))};const m=document.querySelectorAll(".animate-on-scroll"),h=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target;if(e.isIntersecting){t.classList.add("animated");t.querySelectorAll(".counter").forEach(e=>{!function(e,t=2500){if(e.classList.contains("counting"))return;const s=parseInt(e.getAttribute("data-target")),i=e.getAttribute("data-prefix")||"",n=e.getAttribute("data-suffix")||"";if(isNaN(s))return;const a=performance.now();e.classList.add("counting");const l=r=>{const o=r-a,c=Math.min(o/t,1),d=Math.floor(c*s);e.textContent=i+d.toLocaleString()+n,c<1?requestAnimationFrame(l):(e.textContent=i+s.toLocaleString()+n,e.classList.remove("counting"))};requestAnimationFrame(l)}(e)})}else{t.classList.remove("animated");t.querySelectorAll(".counter").forEach(e=>{const t=e.getAttribute("data-prefix")||"",s=e.getAttribute("data-suffix")||"";e.textContent=t+"0"+s,e.classList.remove("counting")})}})},{rootMargin:"0px",threshold:.1});m.forEach(e=>{h.observe(e)}),s&&i&&s.addEventListener("click",()=>{const e="true"===s.getAttribute("aria-expanded"),t=e?"remove":"add";document.body.classList[t]("no-scroll"),s.setAttribute("aria-expanded",String(!e)),i.classList[t]("is-active"),s.classList[t]("is-active")}),n.forEach(e=>{e.addEventListener("click",()=>{i&&s&&i.classList.contains("is-active")&&(document.body.classList.remove("no-scroll"),s.setAttribute("aria-expanded","false"),i.classList.remove("is-active"),s.classList.remove("is-active"))})});const g=document.querySelector(".timeline-container"),f=document.getElementById("timeline-line"),p=document.querySelectorAll(".timeline-item");let v=!1;const y=()=>{if(!g||!f)return;const e=g.getBoundingClientRect(),t=e.top,s=e.bottom,i=e.height,n=window.innerHeight;let a;if(t<n&&s>0){let e=n+i,s=n-t;a=Math.min(100,Math.max(0,s/e*100*1.5))}else a=t>=n?0:100;f.style.height=`${a}%`,p.forEach((e,t)=>{const s=e.getBoundingClientRect(),i=.55*window.innerHeight,n=e.querySelector(".timeline-point");s.top<i?(n.classList.add("bg-gradient-dynamic-accent"),n.classList.remove("bg-subtle-gradient")):(n.classList.remove("bg-gradient-dynamic-accent"),n.classList.add("bg-subtle-gradient"))})},L=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const t=parseInt(e.target.dataset.timelineIndex),s=e.target.querySelector(".timeline-point"),i=t/(p.length-1)*100;f&&(f.style.width=`${i}%`),s.classList.add("bg-gradient-dynamic-accent"),s.classList.remove("bg-subtle-gradient")}})},{root:null,rootMargin:"0px 0px -20% 0px",threshold:.1}),b=()=>{g&&f&&(window.removeEventListener("scroll",y),L.disconnect(),v=!1,f.style.width="0%",f.style.height="0%",p.forEach(e=>{const t=e.querySelector(".timeline-point");t&&(t.classList.remove("bg-gradient-dynamic-accent"),t.classList.add("bg-subtle-gradient"))}),e()?(window.addEventListener("scroll",y),y(),v=!0,f.style.width="2px"):(f.style.height="2px",p.forEach(e=>{L.observe(e)})))};document.addEventListener("DOMContentLoaded",()=>{const e="https://calendly.com/aurore-am20/20min?hide_event_type_details=1&text_color=0e1a35&primary_color=a83287";let t=!1;const s=s=>{s.preventDefault(),(t?Promise.resolve():new Promise(e=>{const s=document.createElement("link");s.href="https://assets.calendly.com/assets/external/widget.css",s.rel="stylesheet",document.head.appendChild(s);const i=document.createElement("script");i.src="https://assets.calendly.com/assets/external/widget.js",i.async=!0,i.onload=()=>{t=!0,e()},document.body.appendChild(i)})).then(()=>{window.Calendly&&"function"==typeof Calendly.initPopupWidget?Calendly.initPopupWidget({url:e}):(console.error("Calendly non chargé, ouverture fallback."),window.open(e,"_blank"))})};document.querySelectorAll(".calendly-popup-trigger").forEach(e=>{e.addEventListener("click",s)})}),(()=>{const e=document.querySelectorAll(".card-deploy");if(0===e.length)return;const t=new IntersectionObserver(function(e,t){e.forEach(e=>{const t=e.target;t.classList.contains("card-left"),t.classList.contains("card-right");e.intersectionRatio>0?(t.classList.remove("is-initially-hidden"),t.classList.add("is-visible")):(t.classList.add("is-initially-hidden"),t.classList.remove("is-visible"))})},{root:null,rootMargin:"0px",threshold:[0,.2]});e.forEach(e=>{e.classList.add("is-initially-hidden"),t.observe(e)})})(),u(),r(),b(),(()=>{const t=document.getElementById("avis-animation-wrapper"),s=document.getElementById("avis-columns-container"),i=Array.from(document.querySelectorAll(".avis-slider .avis-card-wrapper")),n=[];if(!t||!s||0===i.length)return;const a=[];s.innerHTML="";let r=0;for(let e=0;e<10;e++)i.forEach(e=>{const t=e.cloneNode(!0);t.classList.remove("avis-card-wrapper","flex-shrink-0","w-[85vw]","mx-auto","sm:w-[500px]","lg:mx-0","lg:max-w-[450px]","lg:w-full"),t.classList.add("avis-animation-card");const s=l[r%l.length];t.innerHTML=`\n                    <div class="avis-item-content chat-bubble p-0 overflow-hidden">\n                        <img src="${s}" alt="Illustration de site web réalisé par AM 2.0" class="w-full h-auto object-cover" loading="lazy" aria-hidden="true" width="355" height="734">\n                    </div>\n                `;const i=t.querySelector("img");i&&n.push(new Promise(e=>{i.complete?e():(i.onload=e,i.onerror=e)})),r++,a.push(t)});const o=[];for(let t=0;t<3;t++){const i=document.createElement("div");i.classList.add("avis-column"),e()&&(1===t?i.classList.add("avis-column-center"):i.classList.add("avis-column-side")),0===t?i.classList.add("scroll-up"):1===t?i.classList.add("scroll-down"):i.classList.add("scroll-up");const n=document.createElement("div");n.classList.add("avis-scroll-content","h-auto","min-h-full"),o.push(n),i.appendChild(n),s.appendChild(i)}a.forEach((e,t)=>{o[t%3].appendChild(e)}),Promise.all(n).then(()=>{const e=o.reduce((e,t)=>Math.max(e,t.scrollHeight),0)/10*i.length,t=25*e;s.style.setProperty("--scroll-distance",`-${e}px`),s.style.setProperty("--scroll-duration",`${t}ms`)})})(),(()=>{const t=document.querySelector(".avis-slider");if(!t)return void(window.autoSlideInterval&&clearInterval(window.autoSlideInterval));const s=document.querySelector(".avis-controls-wrapper"),i=document.querySelector(".avis-bullets"),n=Array.from(t.querySelectorAll(".avis-card-wrapper"));if(!i||!s||n.length<2)return window.autoSlideInterval&&clearInterval(window.autoSlideInterval),void(s&&s.classList.add("hidden"));const a=n.length;let l=0;s.classList.remove("hidden");const r=s=>{if(s<0||s>=a)return;const r=n[s];let c=e()?24:0,d=r.offsetLeft-c;t.scroll({left:d,behavior:"smooth"}),l=s,i.querySelectorAll(".bullet-trait").forEach(e=>{const t=parseInt(e.dataset.index);e.classList.toggle("active",t===l),e.classList.toggle("inactive",t!==l)}),o(s)},o=e=>{n.forEach((t,s)=>{t.classList.remove("is-hidden"),t.style.opacity="1",s===e?t.style.opacity="1":s===(e+1)%a?t.classList.add("is-hidden"):t.style.opacity="0"})},c=()=>{window.autoSlideInterval&&clearInterval(window.autoSlideInterval),window.autoSlideInterval=setInterval(()=>{l=(l+1)%a,r(l)},5e3)},d=()=>{clearInterval(window.autoSlideInterval),c()};(()=>{i.innerHTML="";for(let e=0;e<a;e++){const t=document.createElement("span");t.classList.add("bullet-trait","w-8","h-1","bg-primary"),t.dataset.index=e,t.classList.toggle("active",0===e),t.classList.toggle("inactive",0!==e),i.appendChild(t),t.addEventListener("click",()=>{r(e),d()})}})(),r(0),c(),t.addEventListener("touchstart",()=>clearInterval(window.autoSlideInterval)),t.addEventListener("touchend",d)})(),(()=>{const e=document.querySelectorAll(".faq-item");0!==e.length&&e.forEach(t=>{const s=t.querySelector(".faq-toggle"),i=t.querySelector(".faq-content");s&&i&&(i.style.maxHeight="0",i.setAttribute("aria-hidden","true"),s.setAttribute("aria-expanded","false"),t.classList.remove("is-open"),s.addEventListener("click",()=>{const n=t.classList.contains("is-open");if(e.forEach(e=>{if(e!==t&&e.classList.contains("is-open")){const t=e.querySelector(".faq-content"),s=e.querySelector(".faq-toggle");t&&(t.style.maxHeight="0",t.setAttribute("aria-hidden","true")),s&&s.setAttribute("aria-expanded","false"),e.classList.remove("is-open")}}),n)i.style.maxHeight="0",i.setAttribute("aria-hidden","true"),s.setAttribute("aria-expanded","false"),t.classList.remove("is-open");else{t.classList.add("is-open");const e=i.scrollHeight;i.style.maxHeight=e+"px",i.setAttribute("aria-hidden","false"),s.setAttribute("aria-expanded","true")}}),i.addEventListener("transitionend",()=>{t.classList.contains("is-open")&&(i.style.maxHeight="none")}))})})(),o(),setupCalendlyTrigger();window.addEventListener("resize",t(()=>{b(),u(),r(),o()},300))});